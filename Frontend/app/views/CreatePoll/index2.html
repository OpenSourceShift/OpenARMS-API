#{extends 'main.html' /} #{ set title:'Create new poll' /}
#{set moreStyles:'createpoll' /}
<div id="main">
	#{form @CreatePoll.submit(), id:'createpoll', class:'greybg wrapper' }
		<h1>&{'create_poll'}</h1>
		<div class="labeledinput">
			<label>&{'createpoll.form.email'}</label>
			#{ifError 'email'}
				<p class="formError">#{error 'email' /}</p>
			#{/ifError}
			<input size="30" type="text" name="email" value="${email}" />
		</div>

    <div class="labeledinput">

			<label>&{'createpoll.form.question'}</label>
			#{ifError 'question'}
				<p class="formError">#{error 'question' /}</p>
			#{/ifError}
			<!--input size="30" type="text" name="question" value="${question}" /-->
    #{rte /}
		</div>

		<div class="labeledinput">
			<label>&{'createpoll.form.pollType'}</label>
			#{ifError 'type'}
				<p class="formError">#{error 'type' /}</p>
			#{/ifError}
			<select name="type" >
				<option value="single">&{'createpoll.form.pollType.single'}</option>
				<option value="multiple">&{'createpoll.form.pollType.multiple'}</option>
			</select>
		</div>

		<div class="labeledinput">
			<label>&{'createpoll.form.answers'}</label>
			#{ifError 'answer'}
				<p class="formError">#{error 'answer' /}</p>
			#{/ifError}
			<ol id='answers'>
				
				    <li class="answerContainer yui-skin-sam">
						<textarea name="answer[]" id="ans[0]" class="ans">Hello</textarea><!--<input type="text" size="60" name="answer[]" value="${_}" class="ans" />-->
						<img src="public/images/i/delete.png" class="removeAnswer">
						<!--<input class="removeAnswer" type="button" value="&{'createpoll.form.removeAnswer'}" />-->
					</li>
				    <li class="answerContainer yui-skin-sam">
						<textarea name="answer[]" id="ans[1]" class="ans"></textarea><!--<input type="text" size="60" name="answer[]" value="${_}" class="ans" />-->
						<img src="public/images/i/delete.png" class="removeAnswer">
						<!--<input class="removeAnswer" type="button" value="&{'createpoll.form.removeAnswer'}" />-->
					</li>
					<input type="hidden" value="2" id="ans_count">
				<span id="AddAnswerButton"><input class='button' type="button" value="&{'createpoll.form.addAnswer'}" /></span>
			</ol>
		</div>
		<input type='button' id="submit_question" value="&{'createpoll.form.submit'}" class='button' />
		<input type='submit' value="&{'createpoll.form.cancel'}" class='button'>
	#{/form}
</div>

<script type="text/javascript">
$(document).ready(function(){
	myFields = new Array();
	$("#editor").val("${question} - ${choices}");
	var answers = ${choices.raw()};
	//$("#ans[0]").val(answers[0]["text"]);
	alert($('#ans[0]').val());
	myFields[0] = new YAHOO.widget.Editor('ans[0]', answerConfig);
	myFields[0].render();
	myFields[1] = new YAHOO.widget.Editor('ans[1]', answerConfig);
	myFields[1].render();
	$("#AddAnswerButton input").bind('click', function() {
		var ans_count = $("#ans_count").val();
		var new_ans_count = parseInt(ans_count)+1;
		$("#ans_count").val(new_ans_count);
		$('<li class="answerContainer yui-skin-sam"><textarea name="answer[]" id="ans['+ans_count+']" class="ans"></textarea><img src="public/images/i/delete.png" class="removeAnswer"> <!--<input class="removeAnswer" type="button" value="&{'createpoll.form.removeAnswer'}" />--></li>').insertBefore("#AddAnswerButton");
		myFields[myFields.length] = new YAHOO.widget.Editor('ans['+ans_count+']', answerConfig);
		myFields[myFields.length-1].render();
		$('.answerContainer:last input').focus();
		bindRemove();
	});
	
	for (i=0; i<answers.length-2; i++) {
		var ans_count = $("#ans_count").val();
		var new_ans_count = parseInt(ans_count)+1;
		$("#ans_count").val(new_ans_count);
		$('<li class="answerContainer yui-skin-sam"><textarea name="answer[]" id="ans['+ans_count+']" class="ans">'+answers[i+2]["text"]+'</textarea><img src="public/images/i/delete.png" class="removeAnswer"> <!--<input class="removeAnswer" type="button" value="&{'createpoll.form.removeAnswer'}" />--></li>').insertBefore("#AddAnswerButton");
		myFields[myFields.length] = new YAHOO.widget.Editor('ans['+(i+2)+']', answerConfig);
		myFields[myFields.length-1].render();
		$('.answerContainer:last input').focus();
		bindRemove();
	}
	function bindRemove() {
		$(".removeAnswer").bind('click', function() {
			$(this).parent().remove();
		});
	};
	
	$("#submit_question").click(function(){
		submit_question();
	});
	
	function submit_question() {
		myEditor.saveHTML();
		for (i=0; i<myFields.length; i++)
			myFields[i].saveHTML();
		$("#createpoll").submit();
	}
	bindRemove();
});
</script>
