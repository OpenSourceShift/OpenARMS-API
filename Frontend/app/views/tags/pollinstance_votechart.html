<div id="main">
	<div class="greybg">
		<div class="wrapper">
			<div id="stats"></div>
			<img class="loading" src="@{'/public/images/loading-big.gif'}" alt="&{'loading'}"/>
		</div>
	</div>
</div>

<script type="text/javascript">
$(function() {
	Highcharts.theme = {
		colors: ["#A4C765"],
		chart: {
			backgroundColor: {
				linearGradient: [0, 0, 0, 400],
				stops: [[0, 'rgb(67, 67, 67)']]
	     	},
			borderWidth: 0,
			borderRadius: 15,
			plotBackgroundColor: null,
			plotShadow: false,
			plotBorderWidth: 0
		},
		title: {
			style: { 
				color: '#FFF',
			    font: '16px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
			}
		},
		xAxis: {
			gridLineWidth: 0,
			lineColor: '#666',
			tickColor: '#666',
			labels: {
				style: {
					color: '#fff',
			        fontWeight: 'bold'
			    }
			},
			title: {
				style: {
					color: '#fff',
					font: '12px "Lucida Grande",Tahoma,"Bitstream Vera Sans",Arial,sans-serif'
				}            
			}
		},
		yAxis: {
			alternateGridColor: null,
			minorTickInterval: null,
			gridLineColor: 'rgba(255, 255, 255, .1)',
			lineWidth: 0,
			tickWidth: 0,
			labels: {
				style: {
					color: '#fff',
					fontWeight: 'bold'
				}
			},
			title: {
				style: {
					color: '#fff',
					font: '12px "Lucida Grande",Tahoma,"Bitstream Vera Sans",Arial,sans-serif'
				}            
			}
		},
		tooltip: {
			backgroundColor: {
				linearGradient: [0, 0, 0, 50],
				stops: [[0, 'rgba(96, 96, 96, .8)']]
			},
			borderWidth: 0,
			style: {
				color: '#FFF'
			}
		},
	};
	
	var highchartsOptions = Highcharts.setOptions(Highcharts.theme);
	
	var choices = [#{list items:_pollInstance.votes, as:'voteSummary'}"${voteSummary.choice_text}"${voteSummary_isLast ? '' : ','}#{/list}];
	
	var chart = new Highcharts.Chart({
		chart: {
			renderTo: 'stats',
			defaultSeriesType: 'column',
			marginRight: 10,
			events: {
				load: function(event) {
				    $.getJSON('/api/pollinstance/${_pollInstance.id}', function(data) {
				    	var vote_count = data.pollinstance.vote_count;
				    	var votes = [];
				    	for(var v in data.pollinstance.votes) {
				    		votes[v] = data.pollinstance.votes[v].count / vote_count * 100;
				    	}
				    	series = votes;
				    });
				}
			}
	    },
	    title: {
	    	text: "${_pollInstance.question}"
	    },
	  	xAxis: {
			categories: choices,
			labels: {
		        rotation: -45,
		    	align: 'right',
	    	}
		},
		yAxis: {
			min: 0,
			max: 100,
			title: {
				text: '&{'joinpoll.success.yAxis'}'
			}
		},
		tooltip: {
			formatter: functio	n() {
				yInVotes = Math.round(this.y*vote_count/100);
				return yInVotes +' &{'joinpoll.success.votes'}';
			}
		},
	    legend: {
	    	enabled: false
	    },
	    series: [{
			data: choices
		}]
	});
});
</script>